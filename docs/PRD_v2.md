# AI 沟通教练 v2.0 - 产品需求文档

> 版本：v2.0  
> 更新日期：2026-01-15  
> 状态：需求已确认

---

## 一、产品定位

### 1.1 一句话定位

**你的 24小时私人沟通教练，记住每段关系的历史，给出最适合你的建议**

### 1.2 核心价值

| 维度 | v1.0 (MVP) | v2.0 (迭代) |
|------|------------|-------------|
| 产品定位 | 一次性话术生成器 | **长期私人沟通教练** |
| 核心价值 | 给3个通用策略 | **懂你的关系 + 精准定制建议** |
| 用户痛点 | 不知道怎么回复 | **缺乏个性化的、能推进关系的有效沟通** |
| 输出形式 | 一次性分析结果页 | **对话式多Agent咨询 + 关系记忆** |

### 1.3 与竞品的核心区别

**vs ChatGPT**：
- ChatGPT 不记得历史，每次都要重新解释
- **我们记住每段关系**，越用越懂你

**vs 小红书/抖音情感咨询**：
- 真人咨询贵（¥300+/次），不能随时找
- **我们 24小时在线**，记住历史不用重复

**vs 恋爱键盘**：
- 恋爱键盘是通用话术，不够精准
- **我们基于关系档案**，定制化建议

### 1.4 用户核心诉求

```
用户不缺"话术库"（小红书到处都是）

用户缺的是：
✅ "适合我说的话" — 符合我的人设
✅ "说完有效的话" — 能推进关系
✅ "懂我们关系的建议" — 基于历史情况
```

---

## 二、多Agent系统设计

### 2.1 为什么用多Agent？

不同的沟通风格适合不同的场景和性格，多Agent让用户：
- 看到**多种思路**，而不是单一答案
- 选择**最适合自己**的风格
- 通过**@追问**深入某个方向

### 2.2 Agent角色定义

| Agent | 职位名称 | 性格昵称 | Emoji | 职责 |
|-------|---------|---------|-------|------|
| 场景分析师 | 场景分析师 | 侦探 | 🎯 | 分析场景、理解双方状态、识别沟通要点 |
| 温柔派顾问 | 温柔派顾问 | 温柔姐姐 | 🤗 | 共情理解、情绪安抚、温柔推进 |
| 幽默派顾问 | 幽默派顾问 | 段子手 | 😄 | 轻松化解、破冰打趣、活跃气氛 |
| 高冷派顾问 | 高冷派顾问 | 冷静分析师 | 😎 | 保持距离、欲擒故纵、不卑不亢 |
| 直球派顾问 | 直球派顾问 | 真诚战士 | 💪 | 坦诚直接、真诚表达、有话直说 |

### 2.3 Agent协作流程

```
用户上传截图 + 背景信息
    ↓
🎯 场景分析师：分析场景 + 理解双方状态
    ↓
🎯 场景分析师：邀请顾问团给出建议
    ↓
4个顾问纵向依次给出话术建议（每条可复制）
    ↓
用户 @某顾问 追问 → 该顾问继续回复
```

---

## 三、界面设计（微信风格）

### 3.1 整体布局

```
┌──────────────┬──────────────────────────────────────────┐
│              │                                          │
│   聊天对象    │              对话区域                     │
│   列表        │         （纵向消息流）                    │
│              │                                          │
│  ┌────────┐  │                                          │
│  │ 👨 男神 │  │   🎯 场景分析师                           │
│  │恋爱·热恋│  │   分析结果...                            │
│  │ 14:16  │  │                                          │
│  └────────┘  │   🤗 温柔派顾问                           │
│              │   话术... [复制]                          │
│  ┌────────┐  │                                          │
│  │ 👔 张总 │  │   😄 幽默派顾问                           │
│  │职场·上级│  │   话术... [复制]                          │
│  │ 昨天   │  │                                          │
│  └────────┘  │   ...                                    │
│              │                                          │
│  ──────────  ├──────────────────────────────────────────┤
│  [+ 添加]    │  有5个角色                                │
│              │  ┌────────────────────────────┐  📷  ➤  │
│              │  │ @温柔派 我觉得这样说太软了   │          │
│              │  └────────────────────────────┘          │
└──────────────┴──────────────────────────────────────────┘
```

### 3.2 左侧：对象列表（微信聊天列表风格）

每个对象显示：
- 头像（emoji 或自定义）
- 名称（如：男神、张总、妈妈）
- 关系类型 + 阶段（如：恋爱·热恋期）
- 最后对话时间

### 3.3 右侧：对话区域

- **纵向消息流**：Agent回复依次展示
- **每条话术可复制**：[复制] 按钮
- **用户消息在右侧**，Agent消息在左侧

### 3.4 底部：输入框

- 显示 **"有5个角色"** 提示用户可以@选择
- 输入 **@** 弹出顾问选择列表
- 支持上传截图 📷
- 发送按钮 ➤

---

## 四、关系档案系统（核心差异化）

### 4.1 为什么需要关系档案？

> "如果这个产品懂我和每一个沟通对象之间的历史情况，以及我想要的人设、预期达到的目的"

关系档案让AI：
- **记住历史**：知道之前发生过什么
- **理解目标**：知道用户想要什么结果
- **匹配人设**：生成符合用户风格的话术

### 4.2 关系档案内容

```typescript
interface Contact {
  id: string;
  name: string;              // 称呼：男神、张总
  avatar: string;            // 头像 emoji
  
  // 关系信息
  relationshipType: string;  // 恋爱/职场/家庭/朋友/其他
  relationshipStage: string; // 暧昧期/热恋期/上级/父母...
  
  // 目标和人设（核心！）
  goal?: string;             // 用户目标：推进到同居阶段
  desiredPersona?: string[]; // 期望人设：独立、温柔、不作不闹
  
  // 历史学习
  successfulStrategies?: string[];  // 有效的策略
  failedStrategies?: string[];      // 无效的策略
}
```

### 4.3 关系类型 & 阶段

| 关系类型 | Emoji | 可选阶段 |
|---------|-------|---------|
| 恋爱 | 💕 | 暧昧期、热恋期、稳定期、冷战期、分手边缘 |
| 职场 | 💼 | 上级、同级、下属、客户、合作伙伴 |
| 家庭 | 👨‍👩‍👧 | 父母、子女、配偶、兄弟姐妹、其他亲戚 |
| 朋友 | 👫 | 闺蜜/死党、普通朋友、新朋友、前任朋友 |
| 其他 | 👤 | 陌生人、网友、其他 |

---

## 五、交互流程

### 5.1 新建对象

点击 [+ 添加] 弹出模态框，填写：
- 称呼
- 关系类型 & 阶段
- （可选）目标、期望人设

### 5.2 对话流程

1. **用户上传截图 + 输入背景**
2. **场景分析师先分析** → 理解双方状态
3. **4个顾问依次给出建议** → 每条话术可复制
4. **用户 @某顾问 追问** → 深入某个方向
5. **系统记录用户选择** → 学习用户偏好

### 5.3 @追问交互

- 输入框输入 `@` 弹出顾问列表
- 选择后自动插入 `@温柔派 `
- 用户继续输入追问内容
- 被@的顾问单独回复

---

## 六、Agent输出格式

### 6.1 场景分析师输出

```json
{
  "scene": {
    "category": "恋爱",
    "subCategory": "冲突修复",
    "description": "因为异地产生的误会"
  },
  "otherPartyAnalysis": {
    "currentEmotion": {
      "primary": "受伤",
      "secondary": "失望",
      "intensity": 7
    },
    "surfaceNeed": "希望对方道歉",
    "deepNeed": "希望被重视、被放在心上",
    "triggers": ["讲道理", "找借口"],
    "soothers": ["主动认错", "表达在意"]
  },
  "communicationGoal": "先安抚情绪，再解决问题"
}
```

### 6.2 风格顾问输出

```json
{
  "strategy": "共情安抚",
  "script": "我知道你现在很难过，是我没有考虑到你的感受...",
  "explanation": "先承认对方的感受，打开沟通的窗口",
  "successRate": 75,
  "riskLevel": "low",
  "riskNote": "如果对方想要实际解决方案，可能觉得不够",
  "nextPossible": [
    {
      "theyMightSay": "你知道就好",
      "youCanReply": "那我们好好聊聊？"
    },
    {
      "theyMightSay": "每次都是嘴上说",
      "youCanReply": "我理解你的担心，我会用行动证明的"
    }
  ]
}
```

---

## 七、数据存储

### 7.1 本地存储（MVP阶段）

使用 localStorage 存储：
- 对象列表（contacts）
- 对话历史（messages）
- 用户偏好（preferences）

### 7.2 后续迁移 Supabase

表结构：
- `users` - 用户表
- `contacts` - 沟通对象
- `conversations` - 对话记录
- `messages` - 消息记录
- `preferences` - 用户偏好

---

## 八、技术实现要点

### 8.1 API 调用策略

**方案：一次调用，前端模拟对话流**

```
POST /api/chat
  ↓
后端一次调用 GPT-4o，返回所有 Agent 结果
  ↓
前端依次渲染，模拟对话流动画效果
```

### 8.2 新增文件结构

```
src/
├── app/
│   ├── api/
│   │   └── chat/
│   │       └── route.ts      # 多Agent对话API
│   └── page.tsx              # 重构为聊天界面
├── components/
│   └── chat/
│       ├── ChatSidebar.tsx   # 左侧对象列表
│       ├── ChatArea.tsx      # 右侧对话区域
│       ├── ChatInput.tsx     # 底部输入框
│       ├── AgentMessage.tsx  # Agent消息卡片
│       ├── UserMessage.tsx   # 用户消息
│       └── AddContactModal.tsx # 添加对象弹窗
├── types/
│   └── chat.ts               # 类型定义
└── lib/
    └── agents.ts             # Agent Prompts
```

---

## 九、开发优先级

### P0 - 核心功能（本周）
- [ ] 微信风格聊天界面（左右分栏）
- [ ] 多Agent对话流（纵向展示）
- [ ] @追问交互
- [ ] 话术复制功能
- [ ] 对象列表管理

### P1 - 体验优化（下周）
- [ ] 关系档案完善（目标、人设）
- [ ] 用户偏好记录
- [ ] 历史对话持久化（localStorage）

### P2 - 后续迭代
- [ ] 迁移到 Supabase
- [ ] 用户登录注册
- [ ] 策略效果学习

---

## 十、更新日志

### v2.0 (2026-01-15)
- 🎯 产品定位升级：从话术生成器 → 私人沟通教练
- 🤖 多Agent系统：5个角色协作
- 💬 微信风格界面：对话式交互
- 📝 关系档案系统：记住每段关系
- @ 追问功能：深入某个方向

### v1.0 (2026-01-12)
- 🎉 MVP 上线
- 截图上传和 AI 分析
- 情绪诊断、问题识别、策略推荐
